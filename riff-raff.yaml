regions: [eu-west-1]

allowedStages: [INFRA]

stacks:
  - deploy
#  - ophan
#  - media-service
#  - infosec
#  - content-api
#  - investigations

deployments:
  cloudformation:
    type: cloud-formation
    app: elasticsearch-node-rotation
    contentDirectory: elasticsearch-node-rotation-cloudformation
    parameters:
      templatePath: cloudformation.yaml
  lambda:
    type: aws-lambda
    dependencies: [cloudformation]
    contentDirectory: elasticsearch-node-rotation
    parameters:
      bucketSsmLookup: true
      fileName: elasticsearch-node-rotation.zip
      functionNames:
        - -enr-get-target-node-
        - -enr-auto-scaling-group-check-
        - -enr-cluster-status-check-
        - -enr-add-node-
        - -enr-cluster-size-check-
        - -enr-reattach-target-instance-
        - -enr-migrate-shards-
        - -enr-shard-migration-check-
        - -enr-remove-node-
